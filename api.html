
<div class='apidiv' style="color:#fff;margin:10px 10px 20px">
	<h2>接入鲁虺阅读器</h2>
	<p>通过外部地址打开 TXT / luhui / ZIP 文件。</p>
	<h3>前置条件</h3>
	<p>1，该外部地址支持本阅读器的跨域请求。</p>
	<p>2，该外部地址支持 https 协议。</p>
	<h3>地址格式</h3>
	<p>https://txtcms.luhui.net/?url=&amp;params=</p>
	<table style="padding: 10px">
		<tbody>
			<tr><th>参数</th><th>说明</th></tr>
			<tr><td>url</td><td>接入的外部地址，最终响应体应为 TXT / luhui / ZIP 文件之一</td></tr>
			<tr><td>params</td><td>接入参数，格式为 JSON 字符串进行 base64 编码（含有中文则需先进行encodeURI编码）</td></tr>
		</tbody>
	</table>
	<h3>params 参数</h3>
	<table style="padding: 10px">
		<tbody>
			<tr><th>参数</th><th>默认值</th><th>说明</th></tr>
			<tr><td>cache</td><td>true</td><td>文件是否保存到本地缓存，否则为临时打开</td></tr>
			<tr><td>readonly</td><td>false</td><td>是否只读，是则无法进行分享和导出</td></tr>
			<tr><td>filename</td><td></td><td>文件名称，不可超过 100 字符</td></tr>
			<tr><td>desc</td><td></td><td>备注，会显示在详情面板，不可超过 100 字符</td></tr>
			<tr><td>base64</td><td>false</td><td>url 地址是否进行 base64 编码</td></tr>
			<tr><td>method</td><td>GET</td><td>url 请求方式，GET 或者 POST</td></tr>
			<tr><td>dfheader</td><td></td><td>自定义请求头，可用于鉴权，需要配合 Access-Control-Allow-Headers 使用</td></tr>
			<tr><td>dfheadervalue</td><td></td><td>自定义请求值，可用于鉴权</td></tr>
		</tbody>
	</table>
	<h3>响应头</h3>
	<p>响应头 luhui 可以覆盖 params 部分参数，优先级更高，值为 JSON 字符串进行 base64 编码</p>
	<p>需要设置响应头 Access-Control-Expose-Headers: luhui</p>
	<table style="padding: 10px">
		<tbody>
			<tr><th>参数</th><th>默认值</th><th>说明</th></tr>
			<tr><td>cache</td><td>true</td><td>是否保存到本地缓存，否则为临时打开</td></tr>
			<tr><td>readonly</td><td>false</td><td>是否只读，是则无法进行分享和导出</td></tr>
			<tr><td>filename</td><td></td><td>文件名称，不可超过 100 字符</td></tr>
			<tr><td>desc</td><td></td><td>备注，会显示在详情面板，不可超过 100 字符</td></tr>
		</tbody>
	</table>
	<h3>文件名称与文件类型</h3>
	<p>文件名称解析顺序：</p>
	<ol><li>响应头 luhui 中的 filename </li><li>params 中的 filename </li><li>响应头 Content-Disposition 中的文件名 </li><li>url 地址最后一个 / 之后的字符串</li></ol>
	<p>文件名称后缀决定文件类型，只包括 TXT / luhui / ZIP 三种，不区分大小写。</p>
	<h3>ZIP 文件</h3>
	<p>zip 文件加载完毕后，如果存在多个内部文件，则打开其中一个之后，再通过返回主页，点击 + 按钮打开 ZIP 文件则可以选择打开其他文件。</p>
	<h3>Nginx 跨域处理（示例）</h3>
	<p><pre>
if ($http_origin ~ "txtcms.luhui.net$") {
	add_header "Access-Control-Allow-Origin" $http_origin;
	add_header 'X-Frame-Options' "ALLOW FROM $http_origin";
	add_header 'Access-Control-Allow-Headers' "dfheader";
	add_header 'Access-Control-Allow-Credentials' 'true';
	add_header 'Access-Control-Expose-Headers' 'Content-Disposition, filename, luhui';
	add_header 'Vary' 'Origin';
}
	</pre></p>
	<h3>测试</h3>
	<p style="text-align: center;"><button class="apitestbtn">生成地址</button></p>
</div>
<script id="apitestdata" type="text/template">
	<div style="margin:5px 10px;">
        url<br><input name="api_url" type="text" class="darkinput" style="padding:0 5px;font-size:16px;line-height:31px;width:95%;border-radius: 5px;" />
    </div>
	<div style="margin:5px 10px;font-weight:bold;color: #8d8d8d;">参数</div>
    <div style="margin:5px 10px;">
        cache&nbsp;&nbsp;<input name="api_cache" type="radio" value="1" checked/> 是&nbsp;&nbsp;<input name="api_cache" type="radio" value="2" /> 否
		&nbsp;&nbsp;
		readonly&nbsp;&nbsp;<input name="api_readonly" type="radio" value="1"/> 是&nbsp;&nbsp;<input name="api_readonly" type="radio" value="2" checked /> 否
		&nbsp;&nbsp;
		base64&nbsp;&nbsp;<input name="api_base64" type="radio" value="1" checked/> 是&nbsp;&nbsp;<input name="api_base64" type="radio" value="2" /> 否
    </div>
	<div style="margin:5px 10px;">
        filename<br><input name="api_filename" type="text" class="darkinput" style="padding:0 5px;font-size:16px;line-height:31px;width:95%;border-radius: 5px;" />
    </div>
	<div style="margin:5px 10px;">
        desc<br><input name="api_desc" type="text" class="darkinput" style="padding:0 5px;font-size:16px;line-height:31px;width:95%;border-radius: 5px;" />
    </div>
    <div style="margin:5px 10px;">
        method<br><input name="api_method" type="text" class="darkinput" style="padding:0 5px;font-size:16px;line-height:31px;width:95%;border-radius: 5px;" value='GET' />
    </div>
    <div style="margin:5px 10px;">
        dfheader<br><input name="api_dfheader" type="text" class="darkinput" style="padding:0 5px;font-size:16px;line-height:31px;width:95%;border-radius: 5px;" />
    </div>
    <div style="margin:5px 10px;">
        dfheadervalue<br><input name="api_dfheadervalue" type="text" class="darkinput" style="padding:0 5px;font-size:16px;line-height:31px;width:95%;border-radius: 5px;" />
    </div>
    <div class='api_result' style="margin:5px 10px;word-wrap: break-word;cursor:pointer;display:none;">
		<h3>完整地址</h3>
		<div class='url_result'></div>
		<h3>响应头</h3>
		<div class='resheader_result'></div>
	</div>
	<p style='text-align:center;margin:10px;'><button class="apitestbtn2">生成地址</button></p>
</script>
